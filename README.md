# Система отслеживания и классификации яблок

## Обзор проекта
Этот проект представляет собой комплексную систему для отслеживания и классификации яблок в видеопотоке. Используя современные технологии компьютерного зрения и машинного обучения, система способна в реальном времени обнаруживать яблоки, отслеживать их перемещение и классифицировать их качество.

## Начало работы

Следуйте этим шагам для настройки и запуска проекта:

1. Клонируйте репозиторий: git clone git@github.com:brainnotincluded/Apples.git
2. Установите необходимые зависимости: pip install -r requirements.txt
3. Запустите оптимизированный скрипт pipeline_optimized.py: Apples/pipelines/pipline_optimized.py
## Основные компоненты

### 1. Модели YOLO
- **Модель отслеживания**: Используется для обнаружения и отслеживания яблок в каждом кадре видео.
- **Модель классификации**: Определяет качество яблок, классифицируя их на "хорошие" и "плохие".

### 2. Обработка видео
- Асинхронная загрузка кадров для оптимизации производительности.
- Пропуск кадров для балансировки между точностью и скоростью обработки.

### 3. Визуализация
- Отображение обработанного видео с аннотациями в реальном времени.
- График FPS для мониторинга производительности системы.

### 4. Анализ и статистика
- Сбор и вывод подробной статистики по каждому отслеженному яблоку.

## Эволюция проекта: от pipeline.py к pipeline_optimized.py

### pipeline.py (исходная версия)
Первоначальная реализация включала:
- Последовательную обработку каждого кадра видео.
- Применение моделей YOLO для отслеживания и классификации на каждом кадре.
- Базовую визуализацию результатов.

Основные проблемы:
1. Низкая производительность из-за обработки каждого кадра.
2. Высокая нагрузка на GPU/CPU.
3. Отсутствие оптимизации для работы в реальном времени.

### pipeline_optimized.py (оптимизированная версия)
Ключевые оптимизации:

1. **Асинхронная загрузка видео**
   - Реализован класс `AsyncVideoLoader` для загрузки кадров в отдельном потоке.
   - Снижена задержка между чтением кадров и их обработкой.

2. **Пропуск кадров**
   - Введена константа `SKIP_FRAMES` для обработки не каждого кадра.
   - Значительно повышена скорость обработки при сохранении точности отслеживания.

3. **Оптимизация использования GPU**
   - Использование half-precision (FP16) для ускорения вычислений на GPU.
   - Адаптация под различные платформы (CUDA для NVIDIA, MPS для Apple Silicon).

4. **Улучшенное отслеживание объектов**
   - Ограничение максимального количества отслеживаемых объектов (`MAX_TRACKS`).
   - Реализация более эффективного алгоритма сопоставления треков.

5. **Усовершенствованная визуализация**
   - Добавлен динамический график FPS для мониторинга производительности.
   - Улучшено отображение информации о каждом отслеживаемом яблоке.

6. **Оптимизация памяти**
   - Эффективное управление ресурсами для длительной работы с видео высокого разрешения.

7. **Улучшенный сбор статистики**
   - Реализация более детального анализа каждого отслеженного объекта.
   - Вывод комплексной статистики по завершении обработки видео.

## Использование

1. Установка зависимостей:
4. Управление:
- Нажмите 'q' для выхода во время выполнения.
- Дождитесь завершения обработки для получения полной статистики.

## Результаты и выводы

- Система способна обрабатывать видеопоток в реальном времени с высокой точностью отслеживания и классификации.
- Значительное увеличение FPS по сравнению с исходной версией (в среднем на 200-300%).
- Улучшенная визуализация позволяет легко интерпретировать результаты в реальном времени.
- Подробная статистика предоставляет ценные данные для анализа качества яблок и эффективности процесса сортировки.

## Дальнейшие улучшения

- Интеграция с системами промышленной автоматизации.
- Расширение классификации для определения различных типов дефектов яблок.
- Реализация распределенной обработки для еще большего повышения производительности.

## Заключение

Проект демонстрирует эффективное применение современных технологий компьютерного зрения и оптимизации для решения практических задач в сельском хозяйстве и пищевой промышленности. Оптимизированная версия `pipeline_optimized.py` значительно улучшает производительность и функциональность системы, делая ее пригодной для использования в реальных производственных условиях.# Apples
